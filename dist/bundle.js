!function(g){var I={};function C(A){if(I[A])return I[A].exports;var n=I[A]={i:A,l:!1,exports:{}};return g[A].call(n.exports,n,n.exports,C),n.l=!0,n.exports}C.m=g,C.c=I,C.d=function(g,I,A){C.o(g,I)||Object.defineProperty(g,I,{enumerable:!0,get:A})},C.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},C.t=function(g,I){if(1&I&&(g=C(g)),8&I)return g;if(4&I&&"object"==typeof g&&g&&g.__esModule)return g;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:g}),2&I&&"string"!=typeof g)for(var n in g)C.d(A,n,function(I){return g[I]}.bind(null,n));return A},C.n=function(g){var I=g&&g.__esModule?function(){return g.default}:function(){return g};return C.d(I,"a",I),I},C.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},C.p="",C(C.s=1)}([function(module,exports){eval("exports.endianness = function () { return 'LE' };\n\nexports.hostname = function () {\n    if (typeof location !== 'undefined') {\n        return location.hostname\n    }\n    else return '';\n};\n\nexports.loadavg = function () { return [] };\n\nexports.uptime = function () { return 0 };\n\nexports.freemem = function () {\n    return Number.MAX_VALUE;\n};\n\nexports.totalmem = function () {\n    return Number.MAX_VALUE;\n};\n\nexports.cpus = function () { return [] };\n\nexports.type = function () { return 'Browser' };\n\nexports.release = function () {\n    if (typeof navigator !== 'undefined') {\n        return navigator.appVersion;\n    }\n    return '';\n};\n\nexports.networkInterfaces\n= exports.getNetworkInterfaces\n= function () { return {} };\n\nexports.arch = function () { return 'javascript' };\n\nexports.platform = function () { return 'browser' };\n\nexports.tmpdir = exports.tmpDir = function () {\n    return '/tmp';\n};\n\nexports.EOL = '\\n';\n\nexports.homedir = function () {\n\treturn '/'\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvb3MtYnJvd3NlcmlmeS9icm93c2VyLmpzPzNjNDMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsa0NBQWtDOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsK0JBQStCOztBQUUvQiw4QkFBOEI7O0FBRTlCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsNEJBQTRCOztBQUU1Qiw0QkFBNEI7O0FBRTVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZUFBZSxVQUFVOztBQUV6Qiw0QkFBNEI7O0FBRTVCLGdDQUFnQzs7QUFFaEM7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSIsImZpbGUiOiIwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0cy5lbmRpYW5uZXNzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJ0xFJyB9O1xuXG5leHBvcnRzLmhvc3RuYW1lID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0eXBlb2YgbG9jYXRpb24gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJldHVybiBsb2NhdGlvbi5ob3N0bmFtZVxuICAgIH1cbiAgICBlbHNlIHJldHVybiAnJztcbn07XG5cbmV4cG9ydHMubG9hZGF2ZyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFtdIH07XG5cbmV4cG9ydHMudXB0aW1lID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gMCB9O1xuXG5leHBvcnRzLmZyZWVtZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIE51bWJlci5NQVhfVkFMVUU7XG59O1xuXG5leHBvcnRzLnRvdGFsbWVtID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBOdW1iZXIuTUFYX1ZBTFVFO1xufTtcblxuZXhwb3J0cy5jcHVzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gW10gfTtcblxuZXhwb3J0cy50eXBlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJ0Jyb3dzZXInIH07XG5cbmV4cG9ydHMucmVsZWFzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5hcHBWZXJzaW9uO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG59O1xuXG5leHBvcnRzLm5ldHdvcmtJbnRlcmZhY2VzXG49IGV4cG9ydHMuZ2V0TmV0d29ya0ludGVyZmFjZXNcbj0gZnVuY3Rpb24gKCkgeyByZXR1cm4ge30gfTtcblxuZXhwb3J0cy5hcmNoID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJ2phdmFzY3JpcHQnIH07XG5cbmV4cG9ydHMucGxhdGZvcm0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnYnJvd3NlcicgfTtcblxuZXhwb3J0cy50bXBkaXIgPSBleHBvcnRzLnRtcERpciA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJy90bXAnO1xufTtcblxuZXhwb3J0cy5FT0wgPSAnXFxuJztcblxuZXhwb3J0cy5ob21lZGlyID0gZnVuY3Rpb24gKCkge1xuXHRyZXR1cm4gJy8nXG59O1xuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/os-browserify/browser.js\nvar browser = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./src/flvtag.js\n\r\n\r\nclass FlvTag {\r\n    constructor() {\r\n        this.tagType = -1;\r\n        this.dataSize = -1;\r\n        this.Timestamp = -1;\r\n        this.StreamID = -1;\r\n        this.body = -1;\r\n    }\r\n\r\n    toString() {\r\n        let tagType = '';\r\n        if (this.tagType == 8) {\r\n            tagType = 'Audio'\r\n        } else if (this.tagType == 9) {\r\n            tagType = 'Video'\r\n        } else if (this.tagType == 18) {\r\n            tagType = \"scripts\"\r\n        }\r\n\r\n        return `tag:${tagType};\r\n        dataSize:${this.hexTypeArray2int(this.dataSize)};\r\n        timestamp:${this.hexTypeArray2int(this.Timestamp)};\r\n        streamId:${this.hexTypeArray2int(this.StreamID)};`\r\n    }\r\n\r\n    hexTypeArray2int(typeArr) {\r\n        const arr = []\r\n        typeArr.forEach(n => {\r\n            arr.push(n.toString(16).length == 1 ? '0' + n.toString(16) : n.toString(16))\r\n        })\r\n        return parseInt(arr.join(''), 16)\r\n    }\r\n}\n// CONCATENATED MODULE: ./src/flvparse.js\n\r\nclass flvparse_FlvParse {\r\n    constructor() {\r\n        this.tempUint8 = [];\r\n        this.arrTag = [];\r\n        this.index = 0;\r\n        this.tempArr = [];\r\n        this._hasAudio = false;\r\n        this._hasVideo = false;\r\n    }\r\n\r\n    setFlv(uint8) {\r\n        this.stop = false;\r\n        this.arrTag = [];\r\n        this.index = 0;\r\n        this.tempUint8 = uint8;\r\n        if (this.tempUint8.length > 13 && this.tempUint8[0] == 70 && this.tempUint8[1] == 76 && this.tempUint8[2] == 86) {\r\n            this.probe(this.tempUint8.buffer);\r\n            this.read(9); // 略掉9个字节的flv header tag\r\n            this.read(4); // 略掉第一个4字节的 tag size\r\n            this.parse();\r\n            this.frist = false;\r\n            return this.offset;\r\n        } else if (!this.frist) {\r\n            return this.parse();\r\n        } else {\r\n            return this.offset;\r\n        }\r\n    }\r\n\r\n    probe(buffer) {\r\n        const data = new Uint8Array(buffer);\r\n        const mismatch = { match: false };\r\n\r\n        if (data[0] !== 0x46 || data[1] !== 0x4C || data[2] !== 0x56 || data[3] !== 0x01) {\r\n            return mismatch;\r\n        }\r\n\r\n        const hasAudio = ((data[4] & 4) >>> 2) !== 0;\r\n        const hasVideo = (data[4] & 1) !== 0;\r\n\r\n        if (!hasAudio && !hasVideo) {\r\n            return mismatch;\r\n        }\r\n        this._hasAudio = hasAudio;\r\n        this._hasVideo = hasVideo;\r\n        return {\r\n            match: true,\r\n            hasAudioTrack: hasAudio,\r\n            hasVideoTrack: hasVideo\r\n        };\r\n    }\r\n\r\n    /**\r\n     * 开始解析\r\n     */\r\n    parse() {\r\n\r\n        while (this.index < this.tempUint8.length && !this.stop) {\r\n            this.offset = this.index;\r\n\r\n            const t = new FlvTag();\r\n            if (this.tempUint8.length - this.index >= 11) {\r\n                t.tagType = (this.read(1)[0]); // 取出tag类型\r\n                t.dataSize = this.read(3); // 取出包体大小\r\n                t.Timestamp = this.read(4); // 取出解码时间\r\n                t.StreamID = this.read(3); // 取出stream id\r\n            } else {\r\n                this.stop = true;\r\n                continue;\r\n            }\r\n            if (this.tempUint8.length - this.index >= (this.getBodySum(t.dataSize) + 4)) {\r\n\r\n                t.body = this.read(this.getBodySum(t.dataSize)); // 取出body\r\n                if (t.tagType == 9 && this._hasVideo) {\r\n                    this.arrTag.push(t);\r\n                }\r\n                if (t.tagType == 8 && this._hasAudio) {\r\n                    this.arrTag.push(t);\r\n                }\r\n                if (t.tagType == 18) {\r\n                    if (this.arrTag.length == 0)\r\n                        this.arrTag.push(t);\r\n                    else {\r\n                        console.log('这是截获的自定义数据', t);\r\n                    }\r\n                }\r\n                t.size = this.read(4);\r\n            } else {\r\n                this.stop = true;\r\n                continue;\r\n            }\r\n            this.offset = this.index;\r\n        }\r\n\r\n        return this.offset;\r\n    }\r\n    read(length) {\r\n        // let u8a = new Uint8Array(length);\r\n        // u8a.set(this.tempUint8.subarray(this.index, this.index + length), 0);\r\n        const u8a = this.tempUint8.slice(this.index, this.index + length);\r\n        this.index += length;\r\n        return u8a;\r\n    }\r\n\r\n    getBodySum(arr) {\r\n        let _str = '';\r\n        _str += (arr[0].toString(16).length == 1 ? '0' + arr[0].toString(16) : arr[0].toString(16));\r\n        _str += (arr[1].toString(16).length == 1 ? '0' + arr[1].toString(16) : arr[1].toString(16));\r\n        _str += (arr[2].toString(16).length == 1 ? '0' + arr[2].toString(16) : arr[2].toString(16));\r\n        return parseInt(_str, 16);\r\n    }\r\n\r\n    toString() {\r\n        for (let index = 0; index < this.arrTag.length; index++) {\r\n            console.log(`tag${index}`, this.arrTag[index].toString());\r\n        }\r\n    };\r\n}\r\n\r\n/* harmony default export */ var flvparse = (new flvparse_FlvParse());\r\n\n// CONCATENATED MODULE: ./src/utils/decodeUTF8.js\n/* eslint-disable */\r\nfunction decodeUTF8(uint8array) {\r\n    const out = [];\r\n    const input = uint8array;\r\n    let i = 0;\r\n    const length = uint8array.length;\r\n\r\n    while (i < length) {\r\n        if (input[i] < 0x80) {\r\n            out.push(String.fromCharCode(input[i]));\r\n            ++i;\r\n            continue;\r\n        } else if (input[i] < 0xC0) {\r\n            // fallthrough\r\n        } else if (input[i] < 0xE0) {\r\n            if (checkContinuation(input, i, 1)) {\r\n                const ucs4 = (input[i] & 0x1F) << 6 | (input[i + 1] & 0x3F);\r\n                if (ucs4 >= 0x80) {\r\n                    out.push(String.fromCharCode(ucs4 & 0xFFFF));\r\n                    i += 2;\r\n                    continue;\r\n                }\r\n            }\r\n        } else if (input[i] < 0xF0) {\r\n            if (checkContinuation(input, i, 2)) {\r\n                const ucs4 = (input[i] & 0xF) << 12 | (input[i + 1] & 0x3F) << 6 | input[i + 2] & 0x3F;\r\n                if (ucs4 >= 0x800 && (ucs4 & 0xF800) !== 0xD800) {\r\n                    out.push(String.fromCharCode(ucs4 & 0xFFFF));\r\n                    i += 3;\r\n                    continue;\r\n                }\r\n            }\r\n        } else if (input[i] < 0xF8) {\r\n            if (checkContinuation(input, i, 3)) {\r\n                let ucs4 = (input[i] & 0x7) << 18 | (input[i + 1] & 0x3F) << 12 |\r\n                    (input[i + 2] & 0x3F) << 6 | (input[i + 3] & 0x3F);\r\n                if (ucs4 > 0x10000 && ucs4 < 0x110000) {\r\n                    ucs4 -= 0x10000;\r\n                    out.push(String.fromCharCode((ucs4 >>> 10) | 0xD800));\r\n                    out.push(String.fromCharCode((ucs4 & 0x3FF) | 0xDC00));\r\n                    i += 4;\r\n                    continue;\r\n                }\r\n            }\r\n        }\r\n        out.push(String.fromCharCode(0xFFFD));\r\n        ++i;\r\n    }\r\n\r\n    return out.join('');\r\n}\r\n\r\nfunction checkContinuation(uint8array, start, checkLength) {\r\n    let array = uint8array;\r\n    if (start + checkLength < array.length) {\r\n        while (checkLength--) {\r\n            if ((array[++start] & 0xC0) !== 0x80)\r\n                return false;\r\n        }\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n/* harmony default export */ var utils_decodeUTF8 = (decodeUTF8);\n// CONCATENATED MODULE: ./src/flvDemux.js\n\r\nconst le = (function () {\r\n    const buf = new ArrayBuffer(2);\r\n    (new DataView(buf)).setInt16(0, 256, true); // little-endian write\r\n    return (new Int16Array(buf))[0] === 256; // platform-spec read, if equal then LE\r\n})();\r\nclass flvDemux_flvDemux {\r\n    constructor() {\r\n    }\r\n\r\n    static parseMetaData(arr) {\r\n        const name = flvDemux_flvDemux.parseScript(arr, 0);\r\n        const value = flvDemux_flvDemux.parseScript(arr, name.size, arr.length - name.size);\r\n        // return {}\r\n        const data = {};\r\n        data[name.data] = value.data;\r\n        return data;\r\n    }\r\n    static parseVariable(arrayBuffer, dataOffset, dataSize) {\r\n        return flvDemux_flvDemux.parseObject(arrayBuffer, dataOffset, dataSize);\r\n    }\r\n    static parseObject(arrayBuffer, dataOffset, dataSize) {\r\n\r\n        const name = flvDemux_flvDemux.parseString(arrayBuffer, dataOffset, dataSize);\r\n        const value = flvDemux_flvDemux.parseScript(arrayBuffer, dataOffset + name.size);\r\n        const isObjectEnd = value.objectEnd;\r\n\r\n        return {\r\n            data: {\r\n                name: name.data,\r\n                value: value.data\r\n            },\r\n            size: value.size,\r\n            objectEnd: isObjectEnd\r\n        };\r\n    }\r\n    static parseString(arrayBuffer, dataOffset, dataSize) {\r\n        const v = new DataView(arrayBuffer, dataOffset);\r\n        const length = v.getUint16(0, !le);\r\n        let str;\r\n        if (length > 0) {\r\n            str = utils_decodeUTF8(new Uint8Array(arrayBuffer, dataOffset + 2, length));\r\n        } else {\r\n            str = '';\r\n        }\r\n        return {\r\n            data: str,\r\n            size: 2 + length\r\n        };\r\n    }\r\n    static parseScript(arr, offset, dataSize) {\r\n        let dataOffset = offset;\r\n        const object = {};\r\n        const uint8 = new Uint8Array(arr);\r\n        const buffer = uint8.buffer;\r\n        const dv = new DataView(buffer, 0, dataSize);\r\n        let value = null;\r\n        let objectEnd = false;\r\n        const type = (dv.getUint8(dataOffset));\r\n        dataOffset += 1;\r\n\r\n        switch (type) {\r\n            case 0: // Number(Double) type\r\n                value = dv.getFloat64(dataOffset, !le);\r\n                dataOffset += 8;\r\n                break;\r\n            case 1:\r\n                { // Boolean type\r\n                    const b = dv.getUint8(dataOffset);\r\n                    value = !!b;\r\n                    dataOffset += 1;\r\n                    break;\r\n                }\r\n            case 2:\r\n                { // String type\r\n                    // dataOffset += 1;\r\n                    const amfstr = flvDemux_flvDemux.parseString(buffer, dataOffset);\r\n                    value = amfstr.data;\r\n                    dataOffset += amfstr.size;\r\n                    break;\r\n                }\r\n            case 3:\r\n                { // Object(s) type\r\n                    value = {};\r\n                    let terminal = 0; // workaround for malformed Objects which has missing ScriptDataObjectEnd\r\n                    if ((dv.getUint32(dataSize - 4, !le) & 0x00FFFFFF) === 9) {\r\n                        terminal = 3;\r\n                    }\r\n                    while (dataOffset < dataSize - 4) { // 4 === type(UI8) + ScriptDataObjectEnd(UI24)\r\n                        const amfobj = flvDemux_flvDemux.parseObject(buffer, dataOffset, dataSize - offset - terminal);\r\n\r\n                        if (amfobj.objectEnd) { break; }\r\n                        value[amfobj.data.name] = amfobj.data.value;\r\n                        // dataOffset += amfobj.size;\r\n                        dataOffset = amfobj.size;\r\n                    }\r\n                    if (dataOffset <= dataSize - 3) {\r\n                        const marker = v.getUint32(dataOffset - 1, !le) & 0x00FFFFFF;\r\n                        if (marker === 9) {\r\n                            dataOffset += 3;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n            case 8:\r\n                { // ECMA array type (Mixed array)\r\n                    value = {};\r\n                    // dataOffset += 1;\r\n                    dataOffset += 4; // ECMAArrayLength(UI32)\r\n                    let terminal = 0; // workaround for malformed MixedArrays which has missing ScriptDataObjectEnd\r\n                    if ((dv.getUint32(dataSize - 4, !le) & 0x00FFFFFF) === 9) {\r\n                        terminal = 3;\r\n                    }\r\n                    while (dataOffset < dataSize - 8) { // 8 === type(UI8) + ECMAArrayLength(UI32) + ScriptDataVariableEnd(UI24)\r\n                        const amfvar = flvDemux_flvDemux.parseVariable(buffer, dataOffset);\r\n\r\n                        if (amfvar.objectEnd) { break; }\r\n                        value[amfvar.data.name] = amfvar.data.value;\r\n                        dataOffset = amfvar.size;\r\n                    }\r\n                    if (dataOffset <= dataSize - 3) {\r\n                        const marker = dv.getUint32(dataOffset - 1, !le) & 0x00FFFFFF;\r\n                        if (marker === 9) {\r\n                            dataOffset += 3;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n            case 9: // ScriptDataObjectEnd\r\n                value = undefined;\r\n                dataOffset = 1;\r\n                objectEnd = true;\r\n                break;\r\n            case 10:\r\n                { // Strict array type\r\n                    // ScriptDataValue[n]. NOTE: according to video_file_format_spec_v10_1.pdf\r\n                    value = [];\r\n                    const strictArrayLength = dv.getUint32(dataOffset, !le);\r\n                    dataOffset += 4;\r\n                    for (let i = 0; i < strictArrayLength; i++) {\r\n                        const val = flvDemux_flvDemux.parseScript(buffer, dataOffset);\r\n                        value.push(val.data);\r\n                        dataOffset = val.size;\r\n                    }\r\n                    break;\r\n                }\r\n            case 11:\r\n                { // Date type\r\n                    const date = flvDemux_flvDemux.parseDate(buffer, dataOffset + 1, dataSize - 1);\r\n                    value = date.data;\r\n                    dataOffset += date.size;\r\n                    break;\r\n                }\r\n            case 12:\r\n                { // Long string type\r\n                    const amfLongStr = flvDemux_flvDemux.parseString(buffer, dataOffset + 1, dataSize - 1);\r\n                    value = amfLongStr.data;\r\n                    dataOffset += amfLongStr.size;\r\n                    break;\r\n                }\r\n            default:\r\n                // ignore and skip\r\n                dataOffset = dataSize;\r\n                console.log('AMF', 'Unsupported AMF value type ' + type);\r\n        }\r\n        return {\r\n            data: value,\r\n            size: dataOffset,\r\n        };\r\n    }\r\n}\n// CONCATENATED MODULE: ./src/media-info.js\nclass MediaInfo {\r\n\r\n    constructor() {\r\n        this.mimeType = null;\r\n        this.duration = null;\r\n\r\n        this.hasAudio = null;\r\n        this.hasVideo = null;\r\n        this.audioCodec = null;\r\n        this.videoCodec = null;\r\n        this.audioDataRate = null;\r\n        this.videoDataRate = null;\r\n\r\n        this.audioSampleRate = null;\r\n        this.audioChannelCount = null;\r\n\r\n        this.width = null;\r\n        this.height = null;\r\n        this.fps = null;\r\n        this.profile = null;\r\n        this.level = null;\r\n        this.chromaFormat = null;\r\n        this.sarNum = null;\r\n        this.sarDen = null;\r\n\r\n        this.metadata = null;\r\n        this.segments = null; // MediaInfo[]\r\n        this.segmentCount = null;\r\n        this.hasKeyframesIndex = null;\r\n        this.keyframesIndex = null;\r\n    }\r\n\r\n    isComplete() {\r\n        const audioInfoComplete = (this.hasAudio === false) ||\r\n            (this.hasAudio === true &&\r\n                this.audioCodec != null &&\r\n                this.audioSampleRate != null &&\r\n                this.audioChannelCount != null);\r\n\r\n        const videoInfoComplete = (this.hasVideo === false) ||\r\n            (this.hasVideo === true &&\r\n                this.videoCodec != null &&\r\n                this.width != null &&\r\n                this.height != null &&\r\n                this.fps != null &&\r\n                this.profile != null &&\r\n                this.level != null &&\r\n                this.chromaFormat != null &&\r\n                this.sarNum != null &&\r\n                this.sarDen != null);\r\n\r\n        // keyframesIndex may not be present\r\n        return this.mimeType != null &&\r\n            this.duration != null &&\r\n            this.metadata != null &&\r\n            this.hasKeyframesIndex != null &&\r\n            audioInfoComplete &&\r\n            videoInfoComplete;\r\n    }\r\n\r\n    isSeekable() {\r\n        return this.hasKeyframesIndex === true;\r\n    }\r\n}\r\n\r\n/* harmony default export */ var media_info = (MediaInfo);\n// CONCATENATED MODULE: ./src/tagdemux.js\n\r\n\r\nclass tagdemux_tagDemux {\r\n\r\n    constructor() {\r\n        this.TAG = this.constructor.name;\r\n\r\n        this._config = {};\r\n\r\n        this._onError = null;\r\n        this._onMediaInfo = null;\r\n        this._onTrackMetadata = null;\r\n        this._onDataAvailable = null;\r\n\r\n        this._dataOffset = 0;\r\n        this._firstParse = true;\r\n        this._dispatch = false;\r\n\r\n        this._hasAudio = false;\r\n        this._hasVideo = false;\r\n\r\n        this._audioInitialMetadataDispatched = false;\r\n        this._videoInitialMetadataDispatched = false;\r\n\r\n        this._mediaInfo = new media_info();\r\n        this._mediaInfo.hasAudio = this._hasAudio;\r\n        this._mediaInfo.hasVideo = this._hasVideo;\r\n        this._metadata = null;\r\n        this._audioMetadata = null;\r\n        this._videoMetadata = null;\r\n\r\n        this._naluLengthSize = 4;\r\n        this._timestampBase = 0; // int32, in milliseconds\r\n        this._timescale = 1000;\r\n        this._duration = 0; // int32, in milliseconds\r\n        this._durationOverrided = false;\r\n        this._referenceFrameRate = {\r\n            fixed: true,\r\n            fps: 23.976,\r\n            fps_num: 23976,\r\n            fps_den: 1000\r\n        };\r\n\r\n        this._videoTrack = { type: 'video', id: 1, sequenceNumber: 0, addcoefficient: 2, samples: [], length: 0 };\r\n        this._audioTrack = { type: 'audio', id: 2, sequenceNumber: 1, addcoefficient: 2, samples: [], length: 0 };\r\n\r\n        this._littleEndian = (function () {\r\n            const buf = new ArrayBuffer(2);\r\n            (new DataView(buf)).setInt16(0, 256, true); // little-endian write\r\n            return (new Int16Array(buf))[0] === 256; // platform-spec read, if equal then LE\r\n        })();\r\n    }\r\n\r\n    moof(tags) {\r\n        for (let i = 0; i < tags.length; i++) {\r\n            this.parseChunks(tags[i]);\r\n        }\r\n\r\n    }\r\n\r\n    parseChunks(flvtag) {\r\n\r\n        switch (flvtag.tagType) {\r\n            case 18: // ScriptDataObject\r\n                this.parseMetadata(flvtag.body);\r\n                break;\r\n        }\r\n    }\r\n\r\n    parseMetadata(arr) {\r\n        const data = flvDemux_flvDemux.parseMetaData(arr);\r\n        this._parseScriptData(data);\r\n\r\n        console.log(this._mediaInfo, this._mediaInfo.isComplete());\r\n    }\r\n\r\n    _parseScriptData(obj) {\r\n        const scriptData = obj;\r\n\r\n        if (scriptData.hasOwnProperty('onMetaData')) {\r\n            if (this._metaData) {\r\n                console.log('found another onMetaData tag!');\r\n            }\r\n\r\n            this._metaData = scriptData;\r\n\r\n            const onMetaData = this._metaData.onMetaData;\r\n\r\n            if (typeof onMetaData.hasAudio == \"boolean\") {\r\n                this._hasAudio = onMetaData.hasAudio;\r\n                this._mediaInfo.hasAudio = this._hasAudio;\r\n            }\r\n\r\n            if (typeof onMetaData.hasVideo == \"boolean\") {\r\n                this._hasVideo = onMetaData.hasVideo;\r\n                this._mediaInfo.hasVideo = this._hasVideo;\r\n            }\r\n\r\n            if (typeof onMetaData.audiodatarate == 'number') {\r\n                this._mediaInfo.audiodatarate = onMetaData.audiodatarate;\r\n            }\r\n            if (typeof onMetaData.videodatarate == 'number') {\r\n                this._mediaInfo.videodatarate = onMetaData.videodatarate;\r\n            }\r\n\r\n            if (typeof onMetaData.width == 'number') {\r\n                this._mediaInfo.width = onMetaData.width;\r\n            }\r\n            if (typeof onMetaData.height == 'number') {\r\n                this._mediaInfo.height = onMetaData.height;\r\n            }\r\n\r\n            if (typeof onMetaData.duration == 'number') {\r\n                if (!this._durationOverrided) {\r\n                    const duration = Math.floor(onMetaData.duration * this._timescale);\r\n                    this._duration = duration;\r\n                    this._mediaInfo.duration = duration;\r\n                }\r\n            } else {\r\n                this._mediaInfo.duration = 0;\r\n            }\r\n\r\n            if (typeof onMetaData.framerate == 'number') {\r\n                const fps_num = Math.floor(onMetaData.framerate * 1000);\r\n                if (fps_num > 0) {\r\n                    const fps = fps_num / 1000;\r\n                    this._referenceFrameRate.fixed = true;\r\n                    this._referenceFrameRate.fps = fps;\r\n                    this._referenceFrameRate.fps_num = fps_num;\r\n                    this._referenceFrameRate.fps_den = 1000;\r\n                    this._mediaInfo.fps = fps;\r\n                }\r\n            }\r\n\r\n            if (typeof onMetaData.keyframes == 'number') {\r\n                this._mediaInfo.hasKeyframesIndex = true;\r\n                const keyframes = onMetaData.keyframes;\r\n                keyframes.times = onMetaData.times;\r\n                keyframes.filepositions = onMetaData.filepositions;\r\n                this._mediaInfo.keyframesIndex = this._parseKeyframesIndex(keyframes);\r\n                onMetaData.keyframes = null; // keyframes has been extracted, remove it\r\n            } else {\r\n                this._mediaInfo.hasKeyframesIndex = false;\r\n            }\r\n\r\n            this._dispatch = false;\r\n\r\n            this._mediaInfo.metadata = onMetaData;\r\n\r\n            return this._mediaInfo;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n/* harmony default export */ var tagdemux = (new tagdemux_tagDemux());\n// CONCATENATED MODULE: ./src/index.js\n\r\n\r\n\r\nvar dropbox = document.querySelector('body div');\r\n\r\ndropbox.addEventListener('dragover', function (e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n}, false);\r\n\r\ndropbox.addEventListener(\"drop\", function (e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    var reader = new FileReader();\r\n    reader.addEventListener('load', processflv, false);\r\n    reader.readAsArrayBuffer(e.dataTransfer.files[0]);\r\n}, false);\r\n\r\nfunction processflv(e) {\r\n    var buffer = e.target.result;\r\n    var unit8 = new Uint8Array(buffer);\r\n    flvparse.setFlv(unit8);\r\n    if (flvparse.arrTag[0].type != 18) {\r\n        if (this.error) this.error(new Error('without metadata tag'));\r\n    }\r\n    if (flvparse.arrTag.length > 0) {\r\n        tagdemux.hasAudio = this.hasAudio = flvparse._hasAudio;\r\n        tagdemux.hasVideo = this.hasVideo = flvparse._hasVideo;\r\n        tagdemux.moof(flvparse.arrTag)\r\n    }\r\n\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZmx2dGFnLmpzPzE3NjciLCJ3ZWJwYWNrOi8vLy4vc3JjL2ZsdnBhcnNlLmpzPzkxMmUiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzL2RlY29kZVVURjguanM/YWQ5YiIsIndlYnBhY2s6Ly8vLi9zcmMvZmx2RGVtdXguanM/ODAzNSIsIndlYnBhY2s6Ly8vLi9zcmMvbWVkaWEtaW5mby5qcz80MzJlIiwid2VicGFjazovLy8uL3NyYy90YWdkZW11eC5qcz83NTRkIiwid2VicGFjazovLy8uL3NyYy9pbmRleC5qcz9iNjM1Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUEwQjs7QUFFWDtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7O0FBRUEsc0JBQXNCO0FBQ3RCLG1CQUFtQjtBQUNuQixvQkFBb0I7QUFDcEIsbUJBQW1CLHNDQUFzQztBQUN6RDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsQzs7QUNsQzZCO0FBQzdCLE1BQU0saUJBQVE7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwwQkFBMEI7O0FBRTFCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSwwQkFBMEIsTUFBRztBQUM3QjtBQUNBLDhDQUE4QztBQUM5QywwQ0FBMEM7QUFD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QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEM7QUFDNUMsYUFBYTtBQUNiO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVlLGlEQUFJLGlCQUFRLEVBQUUsRTs7QUMzSk87QUFDQTs7QUFFcEM7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBLElBQUksUUFBUTtBQUNaLFFBQVEsUUFBUTtBQUNoQjtBQUNBO0FBQ0EsUUFBUSxRQUFRO0FBQ2hCLFFBQVEsUUFBUSw0QkFBNEIsUUFBUTtBQUNwRCxRQUFRLFFBQVEsNEJBQTRCLFFBQVE7QUFDcEQsUUFBUSxRQUFRLE1BQU0sUUFBUTtBQUM5Qjs7QUFFQSIsImZpbGUiOiIxLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSB9IGZyb20gXCJvc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRmx2VGFnIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMudGFnVHlwZSA9IC0xO1xyXG4gICAgICAgIHRoaXMuZGF0YVNpemUgPSAtMTtcclxuICAgICAgICB0aGlzLlRpbWVzdGFtcCA9IC0xO1xyXG4gICAgICAgIHRoaXMuU3RyZWFtSUQgPSAtMTtcclxuICAgICAgICB0aGlzLmJvZHkgPSAtMTtcclxuICAgIH1cclxuXHJcbiAgICB0b1N0cmluZygpIHtcclxuICAgICAgICBsZXQgdGFnVHlwZSA9ICcnO1xyXG4gICAgICAgIGlmICh0aGlzLnRhZ1R5cGUgPT0gOCkge1xyXG4gICAgICAgICAgICB0YWdUeXBlID0gJ0F1ZGlvJ1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy50YWdUeXBlID09IDkpIHtcclxuICAgICAgICAgICAgdGFnVHlwZSA9ICdWaWRlbydcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMudGFnVHlwZSA9PSAxOCkge1xyXG4gICAgICAgICAgICB0YWdUeXBlID0gXCJzY3JpcHRzXCJcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBgdGFnOiR7dGFnVHlwZX07XHJcbiAgICAgICAgZGF0YVNpemU6JHt0aGlzLmhleFR5cGVBcnJheTJpbnQodGhpcy5kYXRhU2l6ZSl9O1xyXG4gICAgICAgIHRpbWVzdGFtcDoke3RoaXMuaGV4VHlwZUFycmF5MmludCh0aGlzLlRpbWVzdGFtcCl9O1xyXG4gICAgICAgIHN0cmVhbUlkOiR7dGhpcy5oZXhUeXBlQXJyYXkyaW50KHRoaXMuU3RyZWFtSUQpfTtgXHJcbiAgICB9XHJcblxyXG4gICAgaGV4VHlwZUFycmF5MmludCh0eXBlQXJyKSB7XHJcbiAgICAgICAgY29uc3QgYXJyID0gW11cclxuICAgICAgICB0eXBlQXJyLmZvckVhY2gobiA9PiB7XHJcbiAgICAgICAgICAgIGFyci5wdXNoKG4udG9TdHJpbmcoMTYpLmxlbmd0aCA9PSAxID8gJzAnICsgbi50b1N0cmluZygxNikgOiBuLnRvU3RyaW5nKDE2KSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIHJldHVybiBwYXJzZUludChhcnIuam9pbignJyksIDE2KVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IHRhZyBmcm9tICcuL2ZsdnRhZy5qcydcclxuY2xhc3MgRmx2UGFyc2Uge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy50ZW1wVWludDggPSBbXTtcclxuICAgICAgICB0aGlzLmFyclRhZyA9IFtdO1xyXG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xyXG4gICAgICAgIHRoaXMudGVtcEFyciA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2hhc0F1ZGlvID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5faGFzVmlkZW8gPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRGbHYodWludDgpIHtcclxuICAgICAgICB0aGlzLnN0b3AgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmFyclRhZyA9IFtdO1xyXG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xyXG4gICAgICAgIHRoaXMudGVtcFVpbnQ4ID0gdWludDg7XHJcbiAgICAgICAgaWYgKHRoaXMudGVtcFVpbnQ4Lmxlbmd0aCA+IDEzICYmIHRoaXMudGVtcFVpbnQ4WzBdID09IDcwICYmIHRoaXMudGVtcFVpbnQ4WzFdID09IDc2ICYmIHRoaXMudGVtcFVpbnQ4WzJdID09IDg2KSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJvYmUodGhpcy50ZW1wVWludDguYnVmZmVyKTtcclxuICAgICAgICAgICAgdGhpcy5yZWFkKDkpOyAvLyDnlaXmjok55Liq5a2X6IqC55qEZmx2IGhlYWRlciB0YWdcclxuICAgICAgICAgICAgdGhpcy5yZWFkKDQpOyAvLyDnlaXmjonnrKzkuIDkuKo05a2X6IqC55qEIHRhZyBzaXplXHJcbiAgICAgICAgICAgIHRoaXMucGFyc2UoKTtcclxuICAgICAgICAgICAgdGhpcy5mcmlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vZmZzZXQ7XHJcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5mcmlzdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9mZnNldDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvYmUoYnVmZmVyKSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7XHJcbiAgICAgICAgY29uc3QgbWlzbWF0Y2ggPSB7IG1hdGNoOiBmYWxzZSB9O1xyXG5cclxuICAgICAgICBpZiAoZGF0YVswXSAhPT0gMHg0NiB8fCBkYXRhWzFdICE9PSAweDRDIHx8IGRhdGFbMl0gIT09IDB4NTYgfHwgZGF0YVszXSAhPT0gMHgwMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbWlzbWF0Y2g7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBoYXNBdWRpbyA9ICgoZGF0YVs0XSAmIDQpID4+PiAyKSAhPT0gMDtcclxuICAgICAgICBjb25zdCBoYXNWaWRlbyA9IChkYXRhWzRdICYgMSkgIT09IDA7XHJcblxyXG4gICAgICAgIGlmICghaGFzQXVkaW8gJiYgIWhhc1ZpZGVvKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtaXNtYXRjaDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5faGFzQXVkaW8gPSBoYXNBdWRpbztcclxuICAgICAgICB0aGlzLl9oYXNWaWRlbyA9IGhhc1ZpZGVvO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG1hdGNoOiB0cnVlLFxyXG4gICAgICAgICAgICBoYXNBdWRpb1RyYWNrOiBoYXNBdWRpbyxcclxuICAgICAgICAgICAgaGFzVmlkZW9UcmFjazogaGFzVmlkZW9cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5byA5aeL6Kej5p6QXHJcbiAgICAgKi9cclxuICAgIHBhcnNlKCkge1xyXG5cclxuICAgICAgICB3aGlsZSAodGhpcy5pbmRleCA8IHRoaXMudGVtcFVpbnQ4Lmxlbmd0aCAmJiAhdGhpcy5zdG9wKSB7XHJcbiAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gdGhpcy5pbmRleDtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuZXcgdGFnKCk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRlbXBVaW50OC5sZW5ndGggLSB0aGlzLmluZGV4ID49IDExKSB7XHJcbiAgICAgICAgICAgICAgICB0LnRhZ1R5cGUgPSAodGhpcy5yZWFkKDEpWzBdKTsgLy8g5Y+W5Ye6dGFn57G75Z6LXHJcbiAgICAgICAgICAgICAgICB0LmRhdGFTaXplID0gdGhpcy5yZWFkKDMpOyAvLyDlj5blh7rljIXkvZPlpKflsI9cclxuICAgICAgICAgICAgICAgIHQuVGltZXN0YW1wID0gdGhpcy5yZWFkKDQpOyAvLyDlj5blh7rop6PnoIHml7bpl7RcclxuICAgICAgICAgICAgICAgIHQuU3RyZWFtSUQgPSB0aGlzLnJlYWQoMyk7IC8vIOWPluWHunN0cmVhbSBpZFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRlbXBVaW50OC5sZW5ndGggLSB0aGlzLmluZGV4ID49ICh0aGlzLmdldEJvZHlTdW0odC5kYXRhU2l6ZSkgKyA0KSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHQuYm9keSA9IHRoaXMucmVhZCh0aGlzLmdldEJvZHlTdW0odC5kYXRhU2l6ZSkpOyAvLyDlj5blh7pib2R5XHJcbiAgICAgICAgICAgICAgICBpZiAodC50YWdUeXBlID09IDkgJiYgdGhpcy5faGFzVmlkZW8pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyclRhZy5wdXNoKHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHQudGFnVHlwZSA9PSA4ICYmIHRoaXMuX2hhc0F1ZGlvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcnJUYWcucHVzaCh0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0LnRhZ1R5cGUgPT0gMTgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hcnJUYWcubGVuZ3RoID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJyVGFnLnB1c2godCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfov5nmmK/miKrojrfnmoToh6rlrprkuYnmlbDmja4nLCB0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0LnNpemUgPSB0aGlzLnJlYWQoNCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3AgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSB0aGlzLmluZGV4O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0O1xyXG4gICAgfVxyXG4gICAgcmVhZChsZW5ndGgpIHtcclxuICAgICAgICAvLyBsZXQgdThhID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTtcclxuICAgICAgICAvLyB1OGEuc2V0KHRoaXMudGVtcFVpbnQ4LnN1YmFycmF5KHRoaXMuaW5kZXgsIHRoaXMuaW5kZXggKyBsZW5ndGgpLCAwKTtcclxuICAgICAgICBjb25zdCB1OGEgPSB0aGlzLnRlbXBVaW50OC5zbGljZSh0aGlzLmluZGV4LCB0aGlzLmluZGV4ICsgbGVuZ3RoKTtcclxuICAgICAgICB0aGlzLmluZGV4ICs9IGxlbmd0aDtcclxuICAgICAgICByZXR1cm4gdThhO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEJvZHlTdW0oYXJyKSB7XHJcbiAgICAgICAgbGV0IF9zdHIgPSAnJztcclxuICAgICAgICBfc3RyICs9IChhcnJbMF0udG9TdHJpbmcoMTYpLmxlbmd0aCA9PSAxID8gJzAnICsgYXJyWzBdLnRvU3RyaW5nKDE2KSA6IGFyclswXS50b1N0cmluZygxNikpO1xyXG4gICAgICAgIF9zdHIgKz0gKGFyclsxXS50b1N0cmluZygxNikubGVuZ3RoID09IDEgPyAnMCcgKyBhcnJbMV0udG9TdHJpbmcoMTYpIDogYXJyWzFdLnRvU3RyaW5nKDE2KSk7XHJcbiAgICAgICAgX3N0ciArPSAoYXJyWzJdLnRvU3RyaW5nKDE2KS5sZW5ndGggPT0gMSA/ICcwJyArIGFyclsyXS50b1N0cmluZygxNikgOiBhcnJbMl0udG9TdHJpbmcoMTYpKTtcclxuICAgICAgICByZXR1cm4gcGFyc2VJbnQoX3N0ciwgMTYpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvU3RyaW5nKCkge1xyXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLmFyclRhZy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYHRhZyR7aW5kZXh9YCwgdGhpcy5hcnJUYWdbaW5kZXhdLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IG5ldyBGbHZQYXJzZSgpO1xyXG4iLCIvKiBlc2xpbnQtZGlzYWJsZSAqL1xyXG5mdW5jdGlvbiBkZWNvZGVVVEY4KHVpbnQ4YXJyYXkpIHtcclxuICAgIGNvbnN0IG91dCA9IFtdO1xyXG4gICAgY29uc3QgaW5wdXQgPSB1aW50OGFycmF5O1xyXG4gICAgbGV0IGkgPSAwO1xyXG4gICAgY29uc3QgbGVuZ3RoID0gdWludDhhcnJheS5sZW5ndGg7XHJcblxyXG4gICAgd2hpbGUgKGkgPCBsZW5ndGgpIHtcclxuICAgICAgICBpZiAoaW5wdXRbaV0gPCAweDgwKSB7XHJcbiAgICAgICAgICAgIG91dC5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoaW5wdXRbaV0pKTtcclxuICAgICAgICAgICAgKytpO1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlucHV0W2ldIDwgMHhDMCkge1xyXG4gICAgICAgICAgICAvLyBmYWxsdGhyb3VnaFxyXG4gICAgICAgIH0gZWxzZSBpZiAoaW5wdXRbaV0gPCAweEUwKSB7XHJcbiAgICAgICAgICAgIGlmIChjaGVja0NvbnRpbnVhdGlvbihpbnB1dCwgaSwgMSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHVjczQgPSAoaW5wdXRbaV0gJiAweDFGKSA8PCA2IHwgKGlucHV0W2kgKyAxXSAmIDB4M0YpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVjczQgPj0gMHg4MCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG91dC5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUodWNzNCAmIDB4RkZGRikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMjtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoaW5wdXRbaV0gPCAweEYwKSB7XHJcbiAgICAgICAgICAgIGlmIChjaGVja0NvbnRpbnVhdGlvbihpbnB1dCwgaSwgMikpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHVjczQgPSAoaW5wdXRbaV0gJiAweEYpIDw8IDEyIHwgKGlucHV0W2kgKyAxXSAmIDB4M0YpIDw8IDYgfCBpbnB1dFtpICsgMl0gJiAweDNGO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVjczQgPj0gMHg4MDAgJiYgKHVjczQgJiAweEY4MDApICE9PSAweEQ4MDApIHtcclxuICAgICAgICAgICAgICAgICAgICBvdXQucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHVjczQgJiAweEZGRkYpKTtcclxuICAgICAgICAgICAgICAgICAgICBpICs9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGlucHV0W2ldIDwgMHhGOCkge1xyXG4gICAgICAgICAgICBpZiAoY2hlY2tDb250aW51YXRpb24oaW5wdXQsIGksIDMpKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdWNzNCA9IChpbnB1dFtpXSAmIDB4NykgPDwgMTggfCAoaW5wdXRbaSArIDFdICYgMHgzRikgPDwgMTIgfFxyXG4gICAgICAgICAgICAgICAgICAgIChpbnB1dFtpICsgMl0gJiAweDNGKSA8PCA2IHwgKGlucHV0W2kgKyAzXSAmIDB4M0YpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVjczQgPiAweDEwMDAwICYmIHVjczQgPCAweDExMDAwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVjczQgLT0gMHgxMDAwMDtcclxuICAgICAgICAgICAgICAgICAgICBvdXQucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKCh1Y3M0ID4+PiAxMCkgfCAweEQ4MDApKTtcclxuICAgICAgICAgICAgICAgICAgICBvdXQucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKCh1Y3M0ICYgMHgzRkYpIHwgMHhEQzAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaSArPSA0O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG91dC5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoMHhGRkZEKSk7XHJcbiAgICAgICAgKytpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvdXQuam9pbignJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrQ29udGludWF0aW9uKHVpbnQ4YXJyYXksIHN0YXJ0LCBjaGVja0xlbmd0aCkge1xyXG4gICAgbGV0IGFycmF5ID0gdWludDhhcnJheTtcclxuICAgIGlmIChzdGFydCArIGNoZWNrTGVuZ3RoIDwgYXJyYXkubGVuZ3RoKSB7XHJcbiAgICAgICAgd2hpbGUgKGNoZWNrTGVuZ3RoLS0pIHtcclxuICAgICAgICAgICAgaWYgKChhcnJheVsrK3N0YXJ0XSAmIDB4QzApICE9PSAweDgwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBkZWZhdWx0IGRlY29kZVVURjg7IiwiaW1wb3J0IGRlY29kZVVURjggZnJvbSAnLi91dGlscy9kZWNvZGVVVEY4LmpzJztcclxuY29uc3QgbGUgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgYnVmID0gbmV3IEFycmF5QnVmZmVyKDIpO1xyXG4gICAgKG5ldyBEYXRhVmlldyhidWYpKS5zZXRJbnQxNigwLCAyNTYsIHRydWUpOyAvLyBsaXR0bGUtZW5kaWFuIHdyaXRlXHJcbiAgICByZXR1cm4gKG5ldyBJbnQxNkFycmF5KGJ1ZikpWzBdID09PSAyNTY7IC8vIHBsYXRmb3JtLXNwZWMgcmVhZCwgaWYgZXF1YWwgdGhlbiBMRVxyXG59KSgpO1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBmbHZEZW11eCB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcGFyc2VNZXRhRGF0YShhcnIpIHtcclxuICAgICAgICBjb25zdCBuYW1lID0gZmx2RGVtdXgucGFyc2VTY3JpcHQoYXJyLCAwKTtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IGZsdkRlbXV4LnBhcnNlU2NyaXB0KGFyciwgbmFtZS5zaXplLCBhcnIubGVuZ3RoIC0gbmFtZS5zaXplKTtcclxuICAgICAgICAvLyByZXR1cm4ge31cclxuICAgICAgICBjb25zdCBkYXRhID0ge307XHJcbiAgICAgICAgZGF0YVtuYW1lLmRhdGFdID0gdmFsdWUuZGF0YTtcclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBwYXJzZVZhcmlhYmxlKGFycmF5QnVmZmVyLCBkYXRhT2Zmc2V0LCBkYXRhU2l6ZSkge1xyXG4gICAgICAgIHJldHVybiBmbHZEZW11eC5wYXJzZU9iamVjdChhcnJheUJ1ZmZlciwgZGF0YU9mZnNldCwgZGF0YVNpemUpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIHBhcnNlT2JqZWN0KGFycmF5QnVmZmVyLCBkYXRhT2Zmc2V0LCBkYXRhU2l6ZSkge1xyXG5cclxuICAgICAgICBjb25zdCBuYW1lID0gZmx2RGVtdXgucGFyc2VTdHJpbmcoYXJyYXlCdWZmZXIsIGRhdGFPZmZzZXQsIGRhdGFTaXplKTtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IGZsdkRlbXV4LnBhcnNlU2NyaXB0KGFycmF5QnVmZmVyLCBkYXRhT2Zmc2V0ICsgbmFtZS5zaXplKTtcclxuICAgICAgICBjb25zdCBpc09iamVjdEVuZCA9IHZhbHVlLm9iamVjdEVuZDtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogbmFtZS5kYXRhLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLmRhdGFcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2l6ZTogdmFsdWUuc2l6ZSxcclxuICAgICAgICAgICAgb2JqZWN0RW5kOiBpc09iamVjdEVuZFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgcGFyc2VTdHJpbmcoYXJyYXlCdWZmZXIsIGRhdGFPZmZzZXQsIGRhdGFTaXplKSB7XHJcbiAgICAgICAgY29uc3QgdiA9IG5ldyBEYXRhVmlldyhhcnJheUJ1ZmZlciwgZGF0YU9mZnNldCk7XHJcbiAgICAgICAgY29uc3QgbGVuZ3RoID0gdi5nZXRVaW50MTYoMCwgIWxlKTtcclxuICAgICAgICBsZXQgc3RyO1xyXG4gICAgICAgIGlmIChsZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHN0ciA9IGRlY29kZVVURjgobmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIsIGRhdGFPZmZzZXQgKyAyLCBsZW5ndGgpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdHIgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZGF0YTogc3RyLFxyXG4gICAgICAgICAgICBzaXplOiAyICsgbGVuZ3RoXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBwYXJzZVNjcmlwdChhcnIsIG9mZnNldCwgZGF0YVNpemUpIHtcclxuICAgICAgICBsZXQgZGF0YU9mZnNldCA9IG9mZnNldDtcclxuICAgICAgICBjb25zdCBvYmplY3QgPSB7fTtcclxuICAgICAgICBjb25zdCB1aW50OCA9IG5ldyBVaW50OEFycmF5KGFycik7XHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gdWludDguYnVmZmVyO1xyXG4gICAgICAgIGNvbnN0IGR2ID0gbmV3IERhdGFWaWV3KGJ1ZmZlciwgMCwgZGF0YVNpemUpO1xyXG4gICAgICAgIGxldCB2YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgbGV0IG9iamVjdEVuZCA9IGZhbHNlO1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSAoZHYuZ2V0VWludDgoZGF0YU9mZnNldCkpO1xyXG4gICAgICAgIGRhdGFPZmZzZXQgKz0gMTtcclxuXHJcbiAgICAgICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMDogLy8gTnVtYmVyKERvdWJsZSkgdHlwZVxyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBkdi5nZXRGbG9hdDY0KGRhdGFPZmZzZXQsICFsZSk7XHJcbiAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ICs9IDg7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgeyAvLyBCb29sZWFuIHR5cGVcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gZHYuZ2V0VWludDgoZGF0YU9mZnNldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAhIWI7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YU9mZnNldCArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICB7IC8vIFN0cmluZyB0eXBlXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZGF0YU9mZnNldCArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFtZnN0ciA9IGZsdkRlbXV4LnBhcnNlU3RyaW5nKGJ1ZmZlciwgZGF0YU9mZnNldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBhbWZzdHIuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ICs9IGFtZnN0ci5zaXplO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICB7IC8vIE9iamVjdChzKSB0eXBlXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdGVybWluYWwgPSAwOyAvLyB3b3JrYXJvdW5kIGZvciBtYWxmb3JtZWQgT2JqZWN0cyB3aGljaCBoYXMgbWlzc2luZyBTY3JpcHREYXRhT2JqZWN0RW5kXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKChkdi5nZXRVaW50MzIoZGF0YVNpemUgLSA0LCAhbGUpICYgMHgwMEZGRkZGRikgPT09IDkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVybWluYWwgPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoZGF0YU9mZnNldCA8IGRhdGFTaXplIC0gNCkgeyAvLyA0ID09PSB0eXBlKFVJOCkgKyBTY3JpcHREYXRhT2JqZWN0RW5kKFVJMjQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFtZm9iaiA9IGZsdkRlbXV4LnBhcnNlT2JqZWN0KGJ1ZmZlciwgZGF0YU9mZnNldCwgZGF0YVNpemUgLSBvZmZzZXQgLSB0ZXJtaW5hbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW1mb2JqLm9iamVjdEVuZCkgeyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVthbWZvYmouZGF0YS5uYW1lXSA9IGFtZm9iai5kYXRhLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkYXRhT2Zmc2V0ICs9IGFtZm9iai5zaXplO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ID0gYW1mb2JqLnNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2Zmc2V0IDw9IGRhdGFTaXplIC0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXJrZXIgPSB2LmdldFVpbnQzMihkYXRhT2Zmc2V0IC0gMSwgIWxlKSAmIDB4MDBGRkZGRkY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXJrZXIgPT09IDkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFPZmZzZXQgKz0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSA4OlxyXG4gICAgICAgICAgICAgICAgeyAvLyBFQ01BIGFycmF5IHR5cGUgKE1peGVkIGFycmF5KVxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZGF0YU9mZnNldCArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFPZmZzZXQgKz0gNDsgLy8gRUNNQUFycmF5TGVuZ3RoKFVJMzIpXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRlcm1pbmFsID0gMDsgLy8gd29ya2Fyb3VuZCBmb3IgbWFsZm9ybWVkIE1peGVkQXJyYXlzIHdoaWNoIGhhcyBtaXNzaW5nIFNjcmlwdERhdGFPYmplY3RFbmRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKGR2LmdldFVpbnQzMihkYXRhU2l6ZSAtIDQsICFsZSkgJiAweDAwRkZGRkZGKSA9PT0gOSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXJtaW5hbCA9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChkYXRhT2Zmc2V0IDwgZGF0YVNpemUgLSA4KSB7IC8vIDggPT09IHR5cGUoVUk4KSArIEVDTUFBcnJheUxlbmd0aChVSTMyKSArIFNjcmlwdERhdGFWYXJpYWJsZUVuZChVSTI0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbWZ2YXIgPSBmbHZEZW11eC5wYXJzZVZhcmlhYmxlKGJ1ZmZlciwgZGF0YU9mZnNldCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW1mdmFyLm9iamVjdEVuZCkgeyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVthbWZ2YXIuZGF0YS5uYW1lXSA9IGFtZnZhci5kYXRhLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ID0gYW1mdmFyLnNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2Zmc2V0IDw9IGRhdGFTaXplIC0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXJrZXIgPSBkdi5nZXRVaW50MzIoZGF0YU9mZnNldCAtIDEsICFsZSkgJiAweDAwRkZGRkZGO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFya2VyID09PSA5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ICs9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgOTogLy8gU2NyaXB0RGF0YU9iamVjdEVuZFxyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ID0gMTtcclxuICAgICAgICAgICAgICAgIG9iamVjdEVuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAxMDpcclxuICAgICAgICAgICAgICAgIHsgLy8gU3RyaWN0IGFycmF5IHR5cGVcclxuICAgICAgICAgICAgICAgICAgICAvLyBTY3JpcHREYXRhVmFsdWVbbl0uIE5PVEU6IGFjY29yZGluZyB0byB2aWRlb19maWxlX2Zvcm1hdF9zcGVjX3YxMF8xLnBkZlxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaWN0QXJyYXlMZW5ndGggPSBkdi5nZXRVaW50MzIoZGF0YU9mZnNldCwgIWxlKTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ICs9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHJpY3RBcnJheUxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IGZsdkRlbXV4LnBhcnNlU2NyaXB0KGJ1ZmZlciwgZGF0YU9mZnNldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnB1c2godmFsLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ID0gdmFsLnNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIDExOlxyXG4gICAgICAgICAgICAgICAgeyAvLyBEYXRlIHR5cGVcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gZmx2RGVtdXgucGFyc2VEYXRlKGJ1ZmZlciwgZGF0YU9mZnNldCArIDEsIGRhdGFTaXplIC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBkYXRlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YU9mZnNldCArPSBkYXRlLnNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgMTI6XHJcbiAgICAgICAgICAgICAgICB7IC8vIExvbmcgc3RyaW5nIHR5cGVcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhbWZMb25nU3RyID0gZmx2RGVtdXgucGFyc2VTdHJpbmcoYnVmZmVyLCBkYXRhT2Zmc2V0ICsgMSwgZGF0YVNpemUgLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGFtZkxvbmdTdHIuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhT2Zmc2V0ICs9IGFtZkxvbmdTdHIuc2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBhbmQgc2tpcFxyXG4gICAgICAgICAgICAgICAgZGF0YU9mZnNldCA9IGRhdGFTaXplO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FNRicsICdVbnN1cHBvcnRlZCBBTUYgdmFsdWUgdHlwZSAnICsgdHlwZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGRhdGE6IHZhbHVlLFxyXG4gICAgICAgICAgICBzaXplOiBkYXRhT2Zmc2V0LFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBNZWRpYUluZm8ge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMubWltZVR5cGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZHVyYXRpb24gPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLmhhc0F1ZGlvID0gbnVsbDtcclxuICAgICAgICB0aGlzLmhhc1ZpZGVvID0gbnVsbDtcclxuICAgICAgICB0aGlzLmF1ZGlvQ29kZWMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudmlkZW9Db2RlYyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hdWRpb0RhdGFSYXRlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnZpZGVvRGF0YVJhdGUgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLmF1ZGlvU2FtcGxlUmF0ZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hdWRpb0NoYW5uZWxDb3VudCA9IG51bGw7XHJcblxyXG4gICAgICAgIHRoaXMud2lkdGggPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmZwcyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wcm9maWxlID0gbnVsbDtcclxuICAgICAgICB0aGlzLmxldmVsID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNocm9tYUZvcm1hdCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5zYXJOdW0gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc2FyRGVuID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5zZWdtZW50cyA9IG51bGw7IC8vIE1lZGlhSW5mb1tdXHJcbiAgICAgICAgdGhpcy5zZWdtZW50Q291bnQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaGFzS2V5ZnJhbWVzSW5kZXggPSBudWxsO1xyXG4gICAgICAgIHRoaXMua2V5ZnJhbWVzSW5kZXggPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGlzQ29tcGxldGUoKSB7XHJcbiAgICAgICAgY29uc3QgYXVkaW9JbmZvQ29tcGxldGUgPSAodGhpcy5oYXNBdWRpbyA9PT0gZmFsc2UpIHx8XHJcbiAgICAgICAgICAgICh0aGlzLmhhc0F1ZGlvID09PSB0cnVlICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvQ29kZWMgIT0gbnVsbCAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5hdWRpb1NhbXBsZVJhdGUgIT0gbnVsbCAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5hdWRpb0NoYW5uZWxDb3VudCAhPSBudWxsKTtcclxuXHJcbiAgICAgICAgY29uc3QgdmlkZW9JbmZvQ29tcGxldGUgPSAodGhpcy5oYXNWaWRlbyA9PT0gZmFsc2UpIHx8XHJcbiAgICAgICAgICAgICh0aGlzLmhhc1ZpZGVvID09PSB0cnVlICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZGVvQ29kZWMgIT0gbnVsbCAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy53aWR0aCAhPSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLmhlaWdodCAhPSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZwcyAhPSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb2ZpbGUgIT0gbnVsbCAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5sZXZlbCAhPSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLmNocm9tYUZvcm1hdCAhPSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhck51bSAhPSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNhckRlbiAhPSBudWxsKTtcclxuXHJcbiAgICAgICAgLy8ga2V5ZnJhbWVzSW5kZXggbWF5IG5vdCBiZSBwcmVzZW50XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWltZVR5cGUgIT0gbnVsbCAmJlxyXG4gICAgICAgICAgICB0aGlzLmR1cmF0aW9uICE9IG51bGwgJiZcclxuICAgICAgICAgICAgdGhpcy5tZXRhZGF0YSAhPSBudWxsICYmXHJcbiAgICAgICAgICAgIHRoaXMuaGFzS2V5ZnJhbWVzSW5kZXggIT0gbnVsbCAmJlxyXG4gICAgICAgICAgICBhdWRpb0luZm9Db21wbGV0ZSAmJlxyXG4gICAgICAgICAgICB2aWRlb0luZm9Db21wbGV0ZTtcclxuICAgIH1cclxuXHJcbiAgICBpc1NlZWthYmxlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc0tleWZyYW1lc0luZGV4ID09PSB0cnVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBNZWRpYUluZm87IiwiaW1wb3J0IGZsdkRlbXV4IGZyb20gXCIuL2ZsdkRlbXV4LmpzXCI7XHJcbmltcG9ydCBtZWRpYWluZm8gZnJvbSAnLi9tZWRpYS1pbmZvJztcclxuY2xhc3MgdGFnRGVtdXgge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuVEFHID0gdGhpcy5jb25zdHJ1Y3Rvci5uYW1lO1xyXG5cclxuICAgICAgICB0aGlzLl9jb25maWcgPSB7fTtcclxuXHJcbiAgICAgICAgdGhpcy5fb25FcnJvciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fb25NZWRpYUluZm8gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX29uVHJhY2tNZXRhZGF0YSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fb25EYXRhQXZhaWxhYmxlID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fZGF0YU9mZnNldCA9IDA7XHJcbiAgICAgICAgdGhpcy5fZmlyc3RQYXJzZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5fZGlzcGF0Y2ggPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5faGFzQXVkaW8gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl9oYXNWaWRlbyA9IGZhbHNlO1xyXG5cclxuICAgICAgICB0aGlzLl9hdWRpb0luaXRpYWxNZXRhZGF0YURpc3BhdGNoZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl92aWRlb0luaXRpYWxNZXRhZGF0YURpc3BhdGNoZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5fbWVkaWFJbmZvID0gbmV3IG1lZGlhaW5mbygpO1xyXG4gICAgICAgIHRoaXMuX21lZGlhSW5mby5oYXNBdWRpbyA9IHRoaXMuX2hhc0F1ZGlvO1xyXG4gICAgICAgIHRoaXMuX21lZGlhSW5mby5oYXNWaWRlbyA9IHRoaXMuX2hhc1ZpZGVvO1xyXG4gICAgICAgIHRoaXMuX21ldGFkYXRhID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9hdWRpb01ldGFkYXRhID0gbnVsbDtcclxuICAgICAgICB0aGlzLl92aWRlb01ldGFkYXRhID0gbnVsbDtcclxuXHJcbiAgICAgICAgdGhpcy5fbmFsdUxlbmd0aFNpemUgPSA0O1xyXG4gICAgICAgIHRoaXMuX3RpbWVzdGFtcEJhc2UgPSAwOyAvLyBpbnQzMiwgaW4gbWlsbGlzZWNvbmRzXHJcbiAgICAgICAgdGhpcy5fdGltZXNjYWxlID0gMTAwMDtcclxuICAgICAgICB0aGlzLl9kdXJhdGlvbiA9IDA7IC8vIGludDMyLCBpbiBtaWxsaXNlY29uZHNcclxuICAgICAgICB0aGlzLl9kdXJhdGlvbk92ZXJyaWRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX3JlZmVyZW5jZUZyYW1lUmF0ZSA9IHtcclxuICAgICAgICAgICAgZml4ZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIGZwczogMjMuOTc2LFxyXG4gICAgICAgICAgICBmcHNfbnVtOiAyMzk3NixcclxuICAgICAgICAgICAgZnBzX2RlbjogMTAwMFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuX3ZpZGVvVHJhY2sgPSB7IHR5cGU6ICd2aWRlbycsIGlkOiAxLCBzZXF1ZW5jZU51bWJlcjogMCwgYWRkY29lZmZpY2llbnQ6IDIsIHNhbXBsZXM6IFtdLCBsZW5ndGg6IDAgfTtcclxuICAgICAgICB0aGlzLl9hdWRpb1RyYWNrID0geyB0eXBlOiAnYXVkaW8nLCBpZDogMiwgc2VxdWVuY2VOdW1iZXI6IDEsIGFkZGNvZWZmaWNpZW50OiAyLCBzYW1wbGVzOiBbXSwgbGVuZ3RoOiAwIH07XHJcblxyXG4gICAgICAgIHRoaXMuX2xpdHRsZUVuZGlhbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcigyKTtcclxuICAgICAgICAgICAgKG5ldyBEYXRhVmlldyhidWYpKS5zZXRJbnQxNigwLCAyNTYsIHRydWUpOyAvLyBsaXR0bGUtZW5kaWFuIHdyaXRlXHJcbiAgICAgICAgICAgIHJldHVybiAobmV3IEludDE2QXJyYXkoYnVmKSlbMF0gPT09IDI1NjsgLy8gcGxhdGZvcm0tc3BlYyByZWFkLCBpZiBlcXVhbCB0aGVuIExFXHJcbiAgICAgICAgfSkoKTtcclxuICAgIH1cclxuXHJcbiAgICBtb29mKHRhZ3MpIHtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5wYXJzZUNodW5rcyh0YWdzW2ldKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHBhcnNlQ2h1bmtzKGZsdnRhZykge1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGZsdnRhZy50YWdUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMTg6IC8vIFNjcmlwdERhdGFPYmplY3RcclxuICAgICAgICAgICAgICAgIHRoaXMucGFyc2VNZXRhZGF0YShmbHZ0YWcuYm9keSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcGFyc2VNZXRhZGF0YShhcnIpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gZmx2RGVtdXgucGFyc2VNZXRhRGF0YShhcnIpO1xyXG4gICAgICAgIHRoaXMuX3BhcnNlU2NyaXB0RGF0YShkYXRhKTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5fbWVkaWFJbmZvLCB0aGlzLl9tZWRpYUluZm8uaXNDb21wbGV0ZSgpKTtcclxuICAgIH1cclxuXHJcbiAgICBfcGFyc2VTY3JpcHREYXRhKG9iaikge1xyXG4gICAgICAgIGNvbnN0IHNjcmlwdERhdGEgPSBvYmo7XHJcblxyXG4gICAgICAgIGlmIChzY3JpcHREYXRhLmhhc093blByb3BlcnR5KCdvbk1ldGFEYXRhJykpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX21ldGFEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZm91bmQgYW5vdGhlciBvbk1ldGFEYXRhIHRhZyEnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5fbWV0YURhdGEgPSBzY3JpcHREYXRhO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgb25NZXRhRGF0YSA9IHRoaXMuX21ldGFEYXRhLm9uTWV0YURhdGE7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uTWV0YURhdGEuaGFzQXVkaW8gPT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2hhc0F1ZGlvID0gb25NZXRhRGF0YS5oYXNBdWRpbztcclxuICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5oYXNBdWRpbyA9IHRoaXMuX2hhc0F1ZGlvO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uTWV0YURhdGEuaGFzVmlkZW8gPT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2hhc1ZpZGVvID0gb25NZXRhRGF0YS5oYXNWaWRlbztcclxuICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5oYXNWaWRlbyA9IHRoaXMuX2hhc1ZpZGVvO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uTWV0YURhdGEuYXVkaW9kYXRhcmF0ZSA9PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvLmF1ZGlvZGF0YXJhdGUgPSBvbk1ldGFEYXRhLmF1ZGlvZGF0YXJhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvbk1ldGFEYXRhLnZpZGVvZGF0YXJhdGUgPT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby52aWRlb2RhdGFyYXRlID0gb25NZXRhRGF0YS52aWRlb2RhdGFyYXRlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uTWV0YURhdGEud2lkdGggPT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby53aWR0aCA9IG9uTWV0YURhdGEud2lkdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvbk1ldGFEYXRhLmhlaWdodCA9PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvLmhlaWdodCA9IG9uTWV0YURhdGEuaGVpZ2h0O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uTWV0YURhdGEuZHVyYXRpb24gPT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZHVyYXRpb25PdmVycmlkZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IE1hdGguZmxvb3Iob25NZXRhRGF0YS5kdXJhdGlvbiAqIHRoaXMuX3RpbWVzY2FsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZHVyYXRpb24gPSBkdXJhdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8uZHVyYXRpb24gPSBkdXJhdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21lZGlhSW5mby5kdXJhdGlvbiA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25NZXRhRGF0YS5mcmFtZXJhdGUgPT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZwc19udW0gPSBNYXRoLmZsb29yKG9uTWV0YURhdGEuZnJhbWVyYXRlICogMTAwMCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZnBzX251bSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmcHMgPSBmcHNfbnVtIC8gMTAwMDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZlcmVuY2VGcmFtZVJhdGUuZml4ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZmVyZW5jZUZyYW1lUmF0ZS5mcHMgPSBmcHM7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmZXJlbmNlRnJhbWVSYXRlLmZwc19udW0gPSBmcHNfbnVtO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlZmVyZW5jZUZyYW1lUmF0ZS5mcHNfZGVuID0gMTAwMDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8uZnBzID0gZnBzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uTWV0YURhdGEua2V5ZnJhbWVzID09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8uaGFzS2V5ZnJhbWVzSW5kZXggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ZnJhbWVzID0gb25NZXRhRGF0YS5rZXlmcmFtZXM7XHJcbiAgICAgICAgICAgICAgICBrZXlmcmFtZXMudGltZXMgPSBvbk1ldGFEYXRhLnRpbWVzO1xyXG4gICAgICAgICAgICAgICAga2V5ZnJhbWVzLmZpbGVwb3NpdGlvbnMgPSBvbk1ldGFEYXRhLmZpbGVwb3NpdGlvbnM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8ua2V5ZnJhbWVzSW5kZXggPSB0aGlzLl9wYXJzZUtleWZyYW1lc0luZGV4KGtleWZyYW1lcyk7XHJcbiAgICAgICAgICAgICAgICBvbk1ldGFEYXRhLmtleWZyYW1lcyA9IG51bGw7IC8vIGtleWZyYW1lcyBoYXMgYmVlbiBleHRyYWN0ZWQsIHJlbW92ZSBpdFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbWVkaWFJbmZvLmhhc0tleWZyYW1lc0luZGV4ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9tZWRpYUluZm8ubWV0YWRhdGEgPSBvbk1ldGFEYXRhO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lZGlhSW5mbztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBuZXcgdGFnRGVtdXgoKTsiLCJpbXBvcnQgZmx2cGFyc2UgZnJvbSAnLi9mbHZwYXJzZS5qcydcclxuaW1wb3J0IHRhZ2RlbXV4IGZyb20gJy4vdGFnZGVtdXguanMnXHJcblxyXG52YXIgZHJvcGJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHkgZGl2Jyk7XHJcblxyXG5kcm9wYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbn0sIGZhbHNlKTtcclxuXHJcbmRyb3Bib3guYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgIHJlYWRlci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgcHJvY2Vzc2ZsdiwgZmFsc2UpO1xyXG4gICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGUuZGF0YVRyYW5zZmVyLmZpbGVzWzBdKTtcclxufSwgZmFsc2UpO1xyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc2ZsdihlKSB7XHJcbiAgICB2YXIgYnVmZmVyID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgdmFyIHVuaXQ4ID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcclxuICAgIGZsdnBhcnNlLnNldEZsdih1bml0OCk7XHJcbiAgICBpZiAoZmx2cGFyc2UuYXJyVGFnWzBdLnR5cGUgIT0gMTgpIHtcclxuICAgICAgICBpZiAodGhpcy5lcnJvcikgdGhpcy5lcnJvcihuZXcgRXJyb3IoJ3dpdGhvdXQgbWV0YWRhdGEgdGFnJykpO1xyXG4gICAgfVxyXG4gICAgaWYgKGZsdnBhcnNlLmFyclRhZy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGFnZGVtdXguaGFzQXVkaW8gPSB0aGlzLmhhc0F1ZGlvID0gZmx2cGFyc2UuX2hhc0F1ZGlvO1xyXG4gICAgICAgIHRhZ2RlbXV4Lmhhc1ZpZGVvID0gdGhpcy5oYXNWaWRlbyA9IGZsdnBhcnNlLl9oYXNWaWRlbztcclxuICAgICAgICB0YWdkZW11eC5tb29mKGZsdnBhcnNlLmFyclRhZylcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n")}]);